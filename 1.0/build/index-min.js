/*!build time : 2014-03-22 7:52:35 PM*/
(function(){KISSY.add("gallery/dragswitch/1.0/main",function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return f=KISSY.all,h=Math.abs,d.webkit?(i="-webkit-",o="webkit"):d.firefox?(i="-moz-",o="moz"):d.ie?(i="-ms-",o="ms"):i=o="",k={senDistance:1,angle:Math.PI/4,isEnabled:null,disable:!1,binds:[null,null,null,null,{moveSelf:!0,moveEls:[],maxDistance:99999,validDistance:null,isEnabled:null,friction:!1,transition:!0}]},m=function(a){return a.css(""+i+"transform")},t=function(a,b){return a[0].style[""+o+"Transform"]=b},s=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.matrixState=m(b));return e},q=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(t(b,b.matrixState));return e},j=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b[0].style[""+o+"Transform"]="");return e},n=function(a){return a[0].style[""+o+"Transition"]},u=function(a,b){return a[0].style[""+o+"Transition"]=b},l=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],b.transitionState=n(b),e.push(u(b,"none"));return e},r=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(u(b,b.transitionState));return e},v=function(a,b,c){var d;return d=p(a),d[4]+=b*c,d[5]+=b*(1-c),"matrix("+d.join(",")+")"},p=function(a){var b;return a||(a="matrix(1,0,0,1,0,0)"),b=a.match(/[0-9\.\-]+/g),b||(b=[1,0,0,1,0,0]),b.forEach(function(a,c){return b[c]=parseFloat(a)}),b},g=function(){function b(b,c){this.el=b,this.config=c,a.mix(this,a.Event.Target),this.init()}return b.prototype.init=function(){var b,c,d,e,g,h,i,j,l;for(this.config=a.merge(k,this.config),this.disable=this.config.disable,"string"==typeof this.el&&(this.isSelector=!0),this.isSelector||(this.el=f(this.el)),this.realEl=f(this.el),this.tanAngel=Math.tan(this.config.angle),j=this.config.binds,e=0,h=j.length;h>e;e++)if(b=j[e],b&&b.moveEls)for(null==b.moveSelf&&(b.moveSelf=!0),l=b.moveEls,c=g=0,i=l.length;i>g;c=++g)d=l[c],b.moveEls[c]=f(d);return this.bindEvents()},b.prototype.bindEvents=function(){var a=this;return this.isSelector?(f("body").delegate("touchstart",this.el,function(b){return a.touchStart(b)}),f("body").delegate("touchmove",this.el,function(b){return a.touchMove(b)}),f("body").delegate("touchend",this.el,function(b){return a.touchEnd(b)})):(this.el.on("touchstart",function(b){return a.touchStart(b)}),this.el.on("touchmove",function(b){return a.touchMove(b)}),this.el.on("touchend",function(b){return a.touchEnd(b)}))},b.prototype.touchStart=function(a){var b,c;if(!this.disable&&(this.fire("touchStart",a),this.enabled=this.config.isEnabled?this.config.isEnabled():!0,this.enabled))return b=a.originalEvent||a,this.istouchStart=!0,this.isSendStart=!1,this.eventType=null,this.key=null,this.actuMoveEls=[],this.startPoint=[b.touches[0].pageX,b.touches[0].pageY],this.originalEl=this.isSelector&&(c=f(b.target).parent(this.el))?c:f(b.currentTarget)},b.prototype.touchMove=function(a){var b,c,d,e,f,g=this;if(this.istouchStart&&(!this.isSendStart||this.effectBind)){if(d=a.originalEvent||a,f=[d.touches[0].pageX,d.touches[0].pageY],e=this.startPoint,b=h((e[1]-f[1])/(f[0]-e[0])),c=[f[0]-e[0],f[1]-e[1]],!this.isSendStart&&b>this.tanAngel&&1/b>this.tanAngel)return void(this.istouchStart=!1);if(!this.eventType){if(b<=this.tanAngel&&h(c[0])>this.config.senDistance)this.eventType=c[0]>0?"left":"right";else{if(!(1/b<=this.tanAngel&&h(c[1])>this.config.senDistance))return;this.eventType=c[1]>0?"top":"bottom"}if(this.key="top"===this.eventType?0:"right"===this.eventType?1:"bottom"===this.eventType?2:"left"===this.eventType?3:null,this.isVertical=1-this.key%2,this.effectBind=this.config.binds[this.key],!this.effectBind)return;this.effectBind.passed=!1,this.moveEls=this.effectBind.moveEls,this.actuMoveEls=this.moveEls.slice(),this.effectBind.moveSelf&&this.actuMoveEls.push(this.originalEl),s(this.actuMoveEls),this.enabled=function(){return g.effectBind.isEnabled?g.effectBind.isEnabled.call(g,a):!0}(),l(this.actuMoveEls)}if(this.eventType&&this.enabled&&this.effectBind)return a.stopPropagation(),this.isSendStart||(this.isSendStart=!0,this.fire(this.eventType+"BeforeMove",a)),this.fire(this.eventType+"Move",a),a.isDefaultPrevented()?void 0:(a.halt(),this.move(f))}},b.prototype.touchEnd=function(a){return this.eventType&&this.enabled&&this.effectBind&&this.istouchStart&&this.isSendStart?this.touchEndHandler(a):void 0},b.prototype.touchEndHandler=function(a){return r(this.actuMoveEls),this.effectBind.transition&&this.transitionEndHandler(),h(this.distance)>=h(this.effectBind.validDistance)?(this.effectBind.passed=!0,j(this.actuMoveEls),this.fire(""+this.eventType+"Passed",a)):q(this.actuMoveEls),this.fire(this.eventType+"TouchEnd touchEnd",a)},b.prototype.transitionEndHandler=function(){var a,b,c,d,f=this;return c=h(this._startPoint-this._lastPoint)/(this.startTimeS-this.lastTimeS),c=4,b=h(this.effectBind.maxDistance-this.distance),a=b/c+"ms",this.actuMoveEls.forEach(function(b){return u(b,""+i+"transform "+a+" ease")}),d=function(){return f.fire(""+f.eventType+"MoveEnd",e),f.actuMoveEls[0].detach(""+o+"TransitionEnd",d)},this.actuMoveEls[0].on(""+o+"TransitionEnd",d)},b.prototype.move=function(a){var b,c,d,e,f,g,i,j,k;for(this.endPoint=a,this.effectBind.transition&&(this.lastTimeS=this.startTimeS?this.startTimeS:null,this.startTimeS=new Date,this._lastPoint=this._startPoint?this._startPoint:null,this._startPoint=this.isVertical?this.endPoint[1]:this.endPoint[0]),f=this.isVertical?this.endPoint[1]-this.startPoint[1]:this.endPoint[0]-this.startPoint[0],d=0===this.key||3===this.key,this.distance=d?f-this.config.senDistance:f+this.config.senDistance,this.effectBind.friction&&this.effectBind.maxDistance&&h(this.distance)>h(this.effectBind.maxDistance)&&(b=Math.sqrt(5*h(e-this.effectBind.maxDistance)),d||(b=-b),this.distance=e=this.effectBind.maxDistance+b),j=this.actuMoveEls,k=[],g=0,i=j.length;i>g;g++)c=j[g],k.push(t(c,v(c.matrixState,this.distance,!this.isVertical)));return k},b}()},{requires:["node","event","ua"]})}).call(this),KISSY.add("gallery/dragswitch/1.0/index",function(a,b){return b},{requires:["./main"]});